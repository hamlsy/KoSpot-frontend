# í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê°€ì´ë“œ

> KoSpot ë°±ì—”ë“œ API í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ì„ ìœ„í•œ ì¢…í•© ë¬¸ì„œ

## ğŸ“š ë¬¸ì„œ ê°œìš”

ì´ í´ë”ì—ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ KoSpot ë¡œë“œë·° ê°œì¸ì „ ê²Œì„ì„ ì—°ë™í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ëª…ì„¸ì™€ ê°€ì´ë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ë¬¸ì„œ ëª©ë¡

### 1ï¸âƒ£ [REST API ëª…ì„¸](./ROADVIEW_SOLO_API_GUIDE.md)
**ê²Œì„ ê´€ë ¨ ëª¨ë“  REST API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ëª…ì„¸**

- ê²Œì„ë°© ìƒì„±/ì¡°íšŒ/ì°¸ì—¬/í‡´ì¥ API
- ê²Œì„ ì‹œì‘ API (ì²« ë¼ìš´ë“œ)
- ì •ë‹µ ì œì¶œ API
- Request/Response í˜•ì‹
- ì¸ì¦ ë°©ì‹
- ì—ëŸ¬ ì½”ë“œ

**ì´ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ì–´ì•¼ í•˜ëŠ” ê²½ìš°:**
- REST API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ê³  ìˆì„ ë•Œ
- Request Body í˜•ì‹ì„ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ
- HTTP ìƒíƒœ ì½”ë“œì™€ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì´í•´í•˜ê³  ì‹¶ì„ ë•Œ

---

### 2ï¸âƒ£ [WebSocket ëª…ì„¸](./ROADVIEW_SOLO_WEBSOCKET_GUIDE.md)
**WebSocket STOMP ì±„ë„ ë° ì‹¤ì‹œê°„ ë©”ì‹œì§€ ëª…ì„¸**

- WebSocket ì—°ê²° ì„¤ì •
- êµ¬ë…í•´ì•¼ í•  ëª¨ë“  ì±„ë„ ëª©ë¡
- íƒ€ì´ë¨¸ ë™ê¸°í™” ë©”ì‹œì§€
- ë¼ìš´ë“œ ê²°ê³¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- ë¼ìš´ë“œ ì „í™˜ íƒ€ì´ë¨¸
- ì œì¶œ ì•Œë¦¼
- ê²Œì„ ì¢…ë£Œ ì•Œë¦¼
- í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ì˜ˆì œ (JavaScript)

**ì´ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ì–´ì•¼ í•˜ëŠ” ê²½ìš°:**
- WebSocket ì—°ê²° ë°©ë²•ì„ ì°¾ê³  ìˆì„ ë•Œ
- ì‹¤ì‹œê°„ ë©”ì‹œì§€ êµ¬ë… ì±„ë„ì„ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ
- íƒ€ì´ë¨¸ ë™ê¸°í™” ë¡œì§ì„ êµ¬í˜„í•˜ê³  ì‹¶ì„ ë•Œ

---

### 3ï¸âƒ£ [í†µí•© í”Œë¡œìš° ê°€ì´ë“œ](./ROADVIEW_SOLO_INTEGRATION_FLOW.md)
**ì „ì²´ ê²Œì„ í”Œë¡œìš° ë° ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ**

- ì „ì²´ ê²Œì„ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨
- ë‹¨ê³„ë³„ ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ
- React êµ¬í˜„ ì˜ˆì œ
- ìƒíƒœ ê´€ë¦¬ (Redux)
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™©
- ìµœì í™” íŒ
- ë©”ëª¨ë¦¬ ê´€ë¦¬
- ì¬ì—°ê²° ì²˜ë¦¬

**ì´ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ì–´ì•¼ í•˜ëŠ” ê²½ìš°:**
- ê²Œì„ ì „ì²´ íë¦„ì„ ì´í•´í•˜ê³  ì‹¶ì„ ë•Œ
- React/Reduxë¥¼ ì‚¬ìš©í•œ êµ¬í˜„ ì˜ˆì œê°€ í•„ìš”í•  ë•Œ
- ì‹¤ì œ í”„ë¡œì íŠ¸ì— í†µí•©í•˜ëŠ” ë°©ë²•ì„ ì•Œê³  ì‹¶ì„ ë•Œ

---

### 4ï¸âƒ£ [Response ëª…ì„¸](./ROADVIEW_SOLO_RESPONSE_SPEC.md)
**ëª¨ë“  Response DTO êµ¬ì¡° ìƒì„¸ ëª…ì„¸**

- ê³µí†µ ì‘ë‹µ í˜•ì‹
- ê²Œì„ë°© ê´€ë ¨ Response
- ê²Œì„ ì§„í–‰ Response
- WebSocket ë©”ì‹œì§€ Response
- TypeScript ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- ë°ì´í„° ë³€í™˜ ìœ í‹¸ë¦¬í‹°
- ê²€ì¦ ë° ì—ëŸ¬ ì²˜ë¦¬

**ì´ ë¬¸ì„œë¥¼ ë¨¼ì € ì½ì–´ì•¼ í•˜ëŠ” ê²½ìš°:**
- Response ë°ì´í„° êµ¬ì¡°ë¥¼ ì •í™•íˆ ì•Œê³  ì‹¶ì„ ë•Œ
- TypeScript íƒ€ì… ì •ì˜ê°€ í•„ìš”í•  ë•Œ
- í•„ë“œë³„ ìƒì„¸ ì„¤ëª…ì´ í•„ìš”í•  ë•Œ

---

## ğŸ® ê²Œì„ í”Œë¡œìš° ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë¡œë“œë·° ê°œì¸ì „ ê²Œì„ í”Œë¡œìš°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ê²Œì„ë°© ì…ì¥
   â†“
2. WebSocket ì—°ê²° ë° ëŒ€ê¸°ì‹¤ êµ¬ë…
   â†“
3. ê²Œì„ ì‹œì‘ (ë°©ì¥)
   â†“
4. ê²Œì„ ì±„ë„ êµ¬ë… + ì²« ë¼ìš´ë“œ ì‹œì‘
   â†“
5. í”Œë ˆì´ì–´ ì •ë‹µ ì œì¶œ
   â†“
6. ë¼ìš´ë“œ ê²°ê³¼ ìˆ˜ì‹  (WebSocket)
   â†“
7. ë¼ìš´ë“œ ì „í™˜ ëŒ€ê¸° (10ì´ˆ)
   â†“
8. ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘ (ìë™)
   â†“
9. 5~8 ë°˜ë³µ (ì´ ë¼ìš´ë“œ ìˆ˜ë§Œí¼)
   â†“
10. ê²Œì„ ì¢…ë£Œ ë° ìµœì¢… ê²°ê³¼
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

### Step 1: WebSocket ì—°ê²°

```javascript
import SockJS from 'sockjs-client';
import { Client } from '@stomp/stompjs';

const socket = new SockJS('http://your-domain.com/ws');
const client = new Client({
  webSocketFactory: () => socket,
  connectHeaders: {
    'Authorization': `Bearer ${token}`
  },
  onConnect: () => {
    console.log('WebSocket connected');
    // ì±„ë„ êµ¬ë… ì‹œì‘
  }
});

client.activate();
```

### Step 2: ê²Œì„ë°© ì°¸ì—¬

```javascript
const joinRoom = async (roomId) => {
  const response = await fetch(`/rooms/${roomId}/players`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ password: null })
  });
  
  const data = await response.json();
  if (data.isSuccess) {
    // ê²Œì„ë°© ì±„ë„ êµ¬ë…
    subscribeToRoomChannels(roomId);
  }
};
```

### Step 3: ê²Œì„ ì‹œì‘ (ë°©ì¥)

```javascript
const startGame = async (roomId) => {
  const response = await fetch(`/rooms/${roomId}/roadview/games/solo`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      gameRoomId: parseInt(roomId),
      playerMatchTypeKey: 'SOLO',
      totalRounds: 5,
      timeLimit: 60000
    })
  });
  
  const data = await response.json();
  if (data.isSuccess) {
    const { gameId, roundInfo, gamePlayers } = data.result;
    
    // ê²Œì„ ì±„ë„ êµ¬ë…
    subscribeToGameChannels(roomId, gameId);
    
    // ì²« ë¼ìš´ë“œ ì‹œì‘
    startRound(roundInfo);
  }
};
```

### Step 4: WebSocket êµ¬ë…

```javascript
const subscribeToGameChannels = (roomId, gameId) => {
  // íƒ€ì´ë¨¸ ì‹œì‘ êµ¬ë…
  client.subscribe(`/topic/game/${roomId}/timer`, (message) => {
    const data = JSON.parse(message.body);
    handleTimerStart(data);
  });
  
  // ë¼ìš´ë“œ ê²°ê³¼ êµ¬ë…
  client.subscribe(`/topic/game/${roomId}/round/result`, (message) => {
    const data = JSON.parse(message.body);
    handleRoundResult(data);
  });
  
  // ë¼ìš´ë“œ ì „í™˜ êµ¬ë…
  client.subscribe(`/topic/game/${roomId}/round/transition`, (message) => {
    const data = JSON.parse(message.body);
    handleRoundTransition(data);
  });
  
  // ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘ êµ¬ë…
  client.subscribe(`/topic/game/${roomId}/round/start`, (message) => {
    const data = JSON.parse(message.body);
    handleNextRound(data);
  });
  
  // ê²Œì„ ì¢…ë£Œ êµ¬ë…
  client.subscribe(`/topic/game/${roomId}/game/finished`, (message) => {
    const data = JSON.parse(message.body);
    handleGameFinished(data);
  });
  
  // ì œì¶œ ì•Œë¦¼ êµ¬ë…
  client.subscribe(`/topic/game/${gameId}/roadview/submissions/player`, (message) => {
    const data = JSON.parse(message.body);
    handlePlayerSubmission(data);
  });
};
```

### Step 5: ì •ë‹µ ì œì¶œ

```javascript
const submitAnswer = async (roomId, gameId, roundId, lat, lng) => {
  const timeToAnswer = Date.now() - roundStartTime;
  
  const response = await fetch(
    `/rooms/${roomId}/games/${gameId}/rounds/${roundId}/submissions/player`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        lat,
        lng,
        timeToAnswer
      })
    }
  );
  
  const data = await response.json();
  if (data.isSuccess) {
    console.log('ì œì¶œ ì™„ë£Œ');
  }
};
```

---

## ğŸ“Š ì£¼ìš” WebSocket ì±„ë„

| ì±„ë„ | ìš©ë„ | ë©”ì‹œì§€ íƒ€ì… |
|------|------|------------|
| `/topic/room/{roomId}/playerList` | í”Œë ˆì´ì–´ ì…ì¥/í‡´ì¥ | PlayerJoinedMessage |
| `/topic/room/{roomId}/chat` | ê²Œì„ë°© ì±„íŒ… | ChatMessage |
| `/topic/room/{roomId}/status` | ê²Œì„ë°© ìƒíƒœ ë³€ê²½ | GameStartedMessage |
| `/topic/game/{roomId}/timer` | íƒ€ì´ë¨¸ ì‹œì‘ | TimerStartMessage |
| `/topic/game/{roomId}/round/result` | ë¼ìš´ë“œ ê²°ê³¼ | RoundResult |
| `/topic/game/{roomId}/round/transition` | ë¼ìš´ë“œ ì „í™˜ ëŒ€ê¸° | RoundTransitionTimerMessage |
| `/topic/game/{roomId}/round/start` | ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘ | NextRoundResponse |
| `/topic/game/{roomId}/game/finished` | ê²Œì„ ì¢…ë£Œ | GameFinishedMessage |
| `/topic/game/{gameId}/roadview/submissions/player` | ì œì¶œ ì•Œë¦¼ | PlayerSubmissionMessage |

---

## ğŸ”‘ ì£¼ìš” REST API ì—”ë“œí¬ì¸íŠ¸

### ê²Œì„ë°© ê´€ë¦¬
- `GET /rooms?page={page}` - ê²Œì„ë°© ëª©ë¡ ì¡°íšŒ
- `POST /rooms` - ê²Œì„ë°© ìƒì„±
- `GET /rooms/{roomId}` - ê²Œì„ë°© ìƒì„¸ ì¡°íšŒ
- `POST /rooms/{roomId}/players` - ê²Œì„ë°© ì°¸ì—¬
- `DELETE /rooms/{roomId}/players` - ê²Œì„ë°© í‡´ì¥

### ê²Œì„ ì§„í–‰
- `POST /rooms/{roomId}/roadview/games/solo` - ê²Œì„ ì‹œì‘ (ì²« ë¼ìš´ë“œ)
- `POST /rooms/{roomId}/games/{gameId}/rounds/{roundId}/submissions/player` - ì •ë‹µ ì œì¶œ

---

## ğŸ’¡ ì¤‘ìš” ê°œë…

### 1. íƒ€ì´ë¨¸ ë™ê¸°í™”

ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ì‹œê°„ ì°¨ì´ë¥¼ ë³´ì •í•˜ì—¬ ì •í™•í•œ íƒ€ì´ë¨¸ í‘œì‹œ:

```javascript
const timeDiff = serverTimestamp - Date.now();
const syncedTime = Date.now() + timeDiff;
```

### 2. ë¼ìš´ë“œ ì „í™˜

ê° ë¼ìš´ë“œ ì¢…ë£Œ í›„ 10ì´ˆ ëŒ€ê¸° ì‹œê°„:

```
ë¼ìš´ë“œ ê²°ê³¼ í‘œì‹œ (ë¬´ì œí•œ)
  â†“
10ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´
  â†“
ë‹¤ìŒ ë¼ìš´ë“œ ìë™ ì‹œì‘
```

### 3. ì¡°ê¸° ì¢…ë£Œ

ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì œì¶œ ì™„ë£Œ ì‹œ íƒ€ì´ë¨¸ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ ë¼ìš´ë“œ ì¢…ë£Œ

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### ë°±ì—”ë“œ
- Spring Boot 3.x
- WebSocket (STOMP)
- MySQL (ê²Œì„ ë°ì´í„°)
- Redis (ì‹¤ì‹œê°„ ë°ì´í„°)

### ê¶Œì¥ í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤íƒ
- React 18+
- TypeScript
- SockJS + @stomp/stompjs
- Redux Toolkit (ìƒíƒœ ê´€ë¦¬)
- Axios (HTTP í´ë¼ì´ì–¸íŠ¸)

---

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì—°ë™ ì „ ì¤€ë¹„ì‚¬í•­
- [ ] JWT ì¸ì¦ í† í° íšë“ ë°©ë²• í™•ì¸
- [ ] WebSocket ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
- [ ] ì§€ë„ API (Google Maps / Kakao Maps) ì—°ë™
- [ ] Street View API ì—°ë™

### í•„ìˆ˜ êµ¬í˜„ ì‚¬í•­
- [ ] WebSocket ì—°ê²° ë° ì¬ì—°ê²°
- [ ] ê²Œì„ë°© ì…ì¥/í‡´ì¥
- [ ] ê²Œì„ ì‹œì‘ (ë°©ì¥)
- [ ] íƒ€ì´ë¨¸ ë™ê¸°í™”
- [ ] ì •ë‹µ ì œì¶œ
- [ ] ë¼ìš´ë“œ ê²°ê³¼ í‘œì‹œ
- [ ] ë¼ìš´ë“œ ì „í™˜ ì¹´ìš´íŠ¸ë‹¤ìš´
- [ ] ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬

### ì„ íƒ êµ¬í˜„ ì‚¬í•­
- [ ] ê²Œì„ë°© ì±„íŒ…
- [ ] í”Œë ˆì´ì–´ ëª©ë¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] ì œì¶œ ì•Œë¦¼ (ëˆ„ê°€ ì œì¶œí–ˆëŠ”ì§€)
- [ ] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ í†µí•œ ê²Œì„ ìƒíƒœ ë³µêµ¬
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§

---

## ğŸ› ë¬¸ì œ í•´ê²°

### WebSocket ì—°ê²° ì‹¤íŒ¨
```javascript
// ì¬ì—°ê²° ë¡œì§
onStompError: (frame) => {
  console.error('STOMP error:', frame);
  setTimeout(() => {
    client.activate(); // ì¬ì—°ê²° ì‹œë„
  }, 5000);
}
```

### íƒ€ì´ë¨¸ ë™ê¸°í™” ì˜¤ë¥˜
```javascript
// ì„œë²„ ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”
const timeDiff = serverTimestamp - Date.now();
const syncedNow = Date.now() + timeDiff;
```

### ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
```javascript
// ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬
useEffect(() => {
  return () => {
    // ëª¨ë“  êµ¬ë… í•´ì œ
    subscriptions.forEach(sub => sub.unsubscribe());
    // íƒ€ì´ë¨¸ ì •ë¦¬
    clearInterval(timerInterval);
  };
}, []);
```

---

## ğŸ“ ì§€ì›

### ë¬¸ì„œ ê´€ë ¨ ë¬¸ì˜
- GitHub Issues ë“±ë¡
- ë°±ì—”ë“œ íŒ€ Slack ì±„ë„

### API ê´€ë ¨ ë¬¸ì˜
- Swagger UI: `http://your-domain.com/swagger-ui.html`
- API ë¬¸ì„œ: ì´ í´ë”ì˜ ë¬¸ì„œë“¤ ì°¸ê³ 

---

## ğŸ“ ë³€ê²½ ì´ë ¥

### 2024-10-26
- ì´ˆê¸° ë¬¸ì„œ ì‘ì„±
- REST API ëª…ì„¸ ì‘ì„±
- WebSocket ëª…ì„¸ ì‘ì„±
- í†µí•© í”Œë¡œìš° ê°€ì´ë“œ ì‘ì„±
- Response ëª…ì„¸ ì‘ì„±

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

### ë°±ì—”ë“œ ë‚´ë¶€ ë¬¸ì„œ
- [ì•„í‚¤í…ì²˜ íë¦„ë„](../ì•„í‚¤í…ì²˜_íë¦„ë„.md)
- [WebSocket êµ¬ë… ê°€ì´ë“œ](../WebSocket-Subscription-Guide.md)
- [Redis STOMP í†µí•© ê°€ì´ë“œ](../Redis-STOMP-Integration-Guide.md)
- [ì¡°ê¸° ì¢…ë£Œ ë¡œì§ êµ¬í˜„](../EARLY_ROUND_COMPLETION_IMPLEMENTATION.md)

### ì™¸ë¶€ ë¦¬ì†ŒìŠ¤
- [Spring WebSocket ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-framework/reference/web/websocket.html)
- [STOMP Protocol](https://stomp.github.io/)
- [SockJS](https://github.com/sockjs/sockjs-client)

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ ë¬¸ì„œëŠ” KoSpot í”„ë¡œì íŠ¸ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.

